#!/usr/bin/env node

'use strict';

const args = require('../lib/argumentor')(process.argv);

if (args._.length === 1 && process.env.CHECKWX_APIKEY) {
  args._.push(process.env.CHECKWX_APIKEY);
}
if (args._.length < 2 || args.help) {
  console.log(`Usage: aerofly-checkwx <ICAO> [CHECKWX_APIKEY] [FILE]

Copy METAR information from https://api.checkwx.com into your Aerofly FS2
configuration file. You will need an API key to fetch information.

If <ICAO> is set to 'XXXX', this tool will look at your last Aerofly FS 2
flight plan and set <ICAO> to your destination airport.

You may supply 'CHECKWX_APIKEY' by setting the environment variable
'CHECKWX_APIKEY'.

Options:
      --hours=<HOURS>        Offset time by HOURS hours, e.g. '-8'
      --time=<HH:MM+ZZ:ZZ>   Set time to HH:MM+ZZ:ZZ, e.g. '12:30-08:00'
      --date=<YYYY-MM-DD>    Set date to YYYY-MM-DD, e.g. '2018-12-31'
      --flightplan           Delete currently active flightplan if origin or
                             destination does not match METAR ICAO code
      --help                 Display this help and exit
      --verbose              Show debug output`);
  process.exit(0);
}

require('../lib/main')(args['verbose'])
  .fromCheckwx(
    args._[1],
    args._[0],
    args._[2]  || 'main.mcf',
    args.hours || 0,
    args.time  || null,
    args.date  || null,
    args.flightplan  || null
  )
;
